<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhamento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

</head>
<style>
    .container-fluid{
        --bs-gutter-y: calc(1rem + 1rem + 250px);
        width: 100%;
        height: calc(100vh - var(--bs-gutter-y));
    }
    .container {
        max-width: 95%;
    }

    .header {
        display: flex;
        width: 100%;
        align-items: center;
        justify-content: space-between;
        background-color: rgb(5, 17, 79);
        color: white;
        box-sizing: border-box;
        padding: 20px;
    }

    .device-header {
        display: flex;
        width: 100%;
        justify-content: space-between;
        padding: 20px;
    }

    .detailing-body {
        display: flex;
        width: 100%;
        align-items: center;
        justify-content: space-between;
        gap: 20px;
        padding: 20px;
    }

</style>
<body>
    <div class="header">
        <img src="../assets/img/defaultLogo.svg" alt="logo" height="80px" style="padding-top: 10px; padding-bottom: 10px; padding-left: 20px;">
        <div class="icones">
            <i class="fas fa-user"></i>
            <i class="fas fa-outdent"></i>
        </div>
    </div>
    <div class="device-header" id="device-header">
        <img src="" alt="so-icon" height="240px" id="so-icon">
        <div style="display: flex; flex-direction: column; flex: 3; align-items: start;" class="my-auto">
            <b>Alias:</b>
            <i style="padding-left: 10px;" id="device-name"></i>
            <hr>
            <b>Endereço IP:</b>
            <i style="padding-left: 10px;" id="device-address"></i>
            <hr>
            <b>S.O.:</b>
            <i style="padding-left: 10px;" id="device-so"></i>
        </div>
        <div class="card" style="flex: 1">
            <div class="card-body" id="status-card-body">
                <h5 class="card-title text-center">
                    Status
                </h5>
                <hr>
                <div style="display: flex; padding: 10px;">
                    <img src="../assets/img/enabled.svg" alt="enabledIcon" id="enabled-icon">
                    <p class="my-auto" style="padding-left: 10px;" id="enabled-label">Ativa</p>
                </div>
                <p style="padding: 10px;">[icone] CPU: 70°</p>
                <p style="padding: 10px;">[icone] DISK: 70°</p>
            </div>
        </div>
    </div>

    <hr>

    <div class="detailing-body">
        <div style="display: flex; flex-direction: column; flex: 1;">
            <button id='cpuButton' class="border-0 p-0">
                <p class="border w-100 h-100 my-auto">CPU</p>
            </button>
            
            <br>

            <button id='memButton' class="border-0 p-0">
                <p class="border w-100 h-100 my-auto">MEM/SWAP</p>
            </button>
            
            <br>

            <button id='diskButton' class="border-0 p-0">
                <p class="border w-100 h-100 my-auto">DISK</p>
            </button>
        </div>
        <div style="flex: 2;">
            <div class="card">
                <div class="card-body" id="detailing-card-body">
                    <h5 class="card-title text-center">CPU</h5>
                    <hr>
                    <div style="display: flex; gap: 20px;">
                            <p class="my-auto" style="text-align: center;">CPU: </p>
                        <div class="progress w-100 my-auto">
                            <div class="progress-bar" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 30%;"></div>
                        </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<script src="../scripts/script.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
<script type="module">
    
    const deviceId = parseInt(getDeviceId('device-id'));

    let serverAddress;
    
    await fetch('../configs/ip_addrs')
    .then((res) => res.text())
    .then((text) => {
        serverAddress = text;
    })
    .catch((e) => console.error(e));
    
    
    let data = await getDataById(deviceId, `http://${serverAddress}:5000/api/maquina_especifica`);
    let cadastros = data[0];
    let estados = data[1];
    
    const cpuButton = document.getElementById('cpuButton');
    const memButton = document.getElementById('memButton');
    const diskButton = document.getElementById('diskButton');
    
    let actualDetailingPage = cpuButton.id;
    
    cpuButton.addEventListener('click', function() {
        actualDetailingPage = cpuButton.id;
        changeDetailingCard(
            cpuButton.id, 
            cadastros[0], 
            estados[0])
        });
    memButton.addEventListener('click', function() {
        actualDetailingPage = memButton.id;
        changeDetailingCard(
            memButton.id, 
            cadastros[0], 
            estados[0])
    })
    diskButton.addEventListener('click', function() {
        actualDetailingPage = diskButton.id;
        changeDetailingCard(
            diskButton.id, 
            cadastros[0], 
            estados[0])
    })


    function changeDetailingCard(buttonClicked, cadastro, estado){

        const detailingCard = document.getElementById('detailing-card-body');
        detailingCard.innerHTML = '';
        const elements = generateDetailingCardContent(buttonClicked, cadastro, estado);

        elements.forEach(element => {
            // console.log(element)
            detailingCard.appendChild(element);
        });
    };

    loadPage(
        document.getElementById('so-icon'),
        document.getElementById('device-name'),
        document.getElementById('device-address'),
        document.getElementById('device-so'),
        document.getElementById('enabled-icon'),
        document.getElementById('enabled-label'),
        cadastros[0],
        estados[0]
    );

    changeDetailingCard(cpuButton.id, cadastros[0], estados[0]);

    // updateDetailingCard(document.getElementById('detailing-card-body'));

    setInterval(async () => {

        let data = await getDataById(deviceId, `http://${serverAddress}:5000/api/maquina_especifica`);
        let cadastros = data[0];
        let estados = data[1];

        updatePage(
        actualDetailingPage,
        document.getElementById('device-header'),
        document.getElementById('detailing-card-body'),
        cadastros[0], 
        estados[0]
        );
    }, 1000)
    

</script>
</html>